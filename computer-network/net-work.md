
### 计算机网络面试常问题

#### 1、网络分层模型

OSI：
   开放式系统互联，国际化标准组织(ISO)制定的理论模型

TCP/IP四层模型：
  基于OSI建立的实际实现的模型

OSI参考模型：
- 应用层
- 表示层
- 会话层
- 传输层
- 网络层
- 数据链路层

TCP/IP四层模型:
  基于OSI建立的实际实现的模型

- 应用层 对应七层模型应用层，表示层，会话层
  
  数据段

- 传输层 对应七层模型的传输层

- 网络层 对应网络层

- 网络接口层 对应网络层和数据链路层


TCP三次握手与四次挥手？

tcp协议与UDP协议

都工作在传输层：在数据之间传输数据

tcp与UDP的区别：tcp基于连接，而UDP不是基于连接的

upd就好比是写信，对方是否收到，内容是否完整，顺序是否正确，都不能够确认

tcp就好比是打电话，从拨打电话到电话接通，然后互相通话，最后结束挂断，这一系列的流程都能得到反馈，并且确认对方准确的接受到

那么tcp是如何确认对方能准确的接收到呢？

基于TCP的三次握手，传输确认，四次挥手

**三次握手**

当客户端向服务端发起连接的时候，会先发一包连接请求数据，过去询问一下，能否建立连接，这包数据被称为SYN包，如果对方同意连接，则会恢复一个SYN+ACK包，客户端收到之后回复一个ACK包，连接建立

这个过程互相收发了三次数据，所以被称为三次握手

**为什么是三次握手而不是两次握手**

为了防止已经失效的请求报文，突然又传到服务器引起错误

这是什么意思？

假设采用两次握手来建立连接，客户端发送一个SYN包来建立连接，如果因为一些原因，这个包未到达服务器，在某个网络节点产生了滞留，为了建立连接客户端会重发SYN包，这次的数据包正常到达，服务端恢复了SYN+ACK之后成功建立了连接，但是第一包数据阻塞的网络节点突然恢复，第一包SYN包又到达了服务端，这时候服务端会误以为客户端又建立了一个新的连接，从而在两次握手之后进入等待数据状态

服务端认为是两个连接，而客户端认为是一个连接，造成了数据不一致的情况

如果在三次握手的情况下，服务端收不到最后的ACK包，自然不会认为连接建立成功，所以三次握手本质上来说就是为了解决网络信道不可靠的问题

为了能够在不可靠的信道上建立可靠的连接

经过三次握手之后，客户端和服务端都进入了数据传输状态

tcp协议需要在不可靠的信道上保证可靠的连接

有这样几个问题需要解决

一包数据有可能被拆成多包发送，如何处理丢包问题？

这些数据包到达的先后顺序不同，如何处理乱序问题？

针对这些要求，tcp为每一个协议建立了一个发送缓冲区

从建立连接的第一个字节的序列号为0，后面每个字节的序列号就会增加1

发送数据时，从发送缓冲区取一部分数据组成发送报文

在其tcp协议头中会附带序列号和长度

接收端在收到数据后需要回复确认报文

确认报文中的ACk等于接收序列号加长度，也就是下一包数据需要发送的起始序列号

这样一问一答的发送方式，能够使发送端确认发送的数据已经被对方收到，发送端也可以一次发送连续的多包数据，接收端只需要回复一次ACK就可以了

这样发送端可以将待发送的数据切割成一段一段的发送给接收端，接收端可以根据序列号和长度重组

假设丢失了某些数据，接收端可以要求发送端重传，比如丢失了100-199这一百个字节，接收端向发送端发送ACK等于100的报文

接收端收到后重传这一包数据，接收端进行补齐

tcp连接时全双工的，对于两端都采用这种方式

**四次挥手**

四次挥手用来关闭连接

假设客户端主动发起连接关闭请求，他需要向服务端发起一包FIN包，表示连接关闭，自己进入终止等待1状态，这是第一次挥手

服务端收到fin包，返回一包ACK包，表示自己进入关闭等待状态
客户端进入终止等待2状态，这是第二次挥手，服务端此时还可以发送未发送的数据，客户端还可以接收数据

待服务端发送完之后，发送一包fin包，进入最后确认状态(这是第三次挥手)

客户端收到回复ACK包，进入超时等待状态，经过超时时间之后关闭连接，服务端收到ACK包后立即关闭连接，这是第四次挥手

**为什么客户端需要等待超时时间？**

这是为了保证对方已经收到ACK包，因为假设客户端发送完最后一包ACK包后就释放连接，一旦ACK包在网络中丢失，服务端将一直停留在最后确认状态

如果客户端发送最后一包ACK包后，等待一段时间，这时服务端因为没有收到ACK包，会重发FIN包，客户端会响应这个fin包，重发ACK包，并刷新超时时间

这个机制跟三次握手一样，也是为了保证在不可靠的网络链路中，进行可靠的连接断开与确认


**UDP协议**

UDP协议是无连接的协议，发送数据就是简单的把数据封装一下，然后从网卡发出去就可以了，数据包之间并没有状态上的联系

UDP这种简单的处理方式，导致他的性能损耗非常少，对于CPU，内存资源的占用也远小于TCP，对于网络传输过程中的丢包，UDP并不能保证

udp在传输稳定上要弱于tcp

**TCP和UDP的主要区别**

tcp传输数据稳定可靠，适用于对网络通信质量要求较高的场景
需要准确无误的传输给对方，比如传输文件，发送邮件，浏览网页等

UDP的传输速度快，但是可能产生丢包，所以适用于对实时性要求较高，但是对少量丢包并没有太大要求的场景，比如域名查询，语言通话，视频直播等

UDP还有一个非常常见的场景，隧道网络
VPN就是一种隧道网络

### 网络分层模型

网络分层模型有两大流派

OSI七层模型，学院派
TCP/IP协议的五层模型，实践派

OSI七层模型：               TCP/IP

- 应用层                   

- 表示层                    应用层

- 会话层

- 传输层                    传输层

- 网络层                    网络层

- 数据链路层                数据链路层

- 物理层                    物理层