## 依赖注入wire

**安装**
```go
go get github.com/google/wire/cmd/wire
```

wire有两个基础概念：provider(构造器)和injector(注入器)
provider实际就是创建函数。每个注入器实际上就是一个对象的创建和初始化函数。
在这个函数中，我们只需要告诉wire要创建什么类型的对象，这个类型的依赖，wire工具会为我们生成依赖

我们简单实现一个例子

假如有黑暗的世界里有一头怪兽

```go
type Monster struct{
    Name string
}

func NewMonster()Monster{
    return Monster{Name:"Kitty"}
}
```

假如黑暗的世界里还有一位勇士
```go
type Player struct{
    Name string
}

func NewPlayer(name string)Player{
    return Player{Name:name}
}
```

很显然，勇士打死了怪兽
```go
type Mission struct{
    Player Player
    Monster Monster
}

func NewMission(p Player,m Monster)Mission{
    return Mission{p,m}
}

func (m Mission)Start(){
    fmt.Printf("%s defeats %s, world peace!\n", m.Player.Name, m.Monster.Name)
}
```

将上面的内容组装到一个应用里面
```go
func main() {
  monster := NewMonster()
  player := NewPlayer("dj")
  mission := NewMission(player, monster)

  mission.Start()
}
```

我们来看一下使用wire怎么做？

新建一个wire.go文件
```go
//+build wireinject

package main

import "github.com/google/wire"

func InitMission(name string) Mission {
  wire.Build(NewMonster, NewPlayer, NewMission)
  return Mission{}
}
```

首先，这个函数的返回值就是我们需要创建的对象类型，wire只需要知道类型，return后返回什么不重要，然后在函数中，我们调用wire.Build()将创建Mission所依赖的类型的构造器传进去
需要调用NewMission()创建Mission类型，NewMission()接受两个参数一个Monster类型，一个Player类型。Monster类型对象需要调用NewMonster()创建，Player类型对象需要调用NewPlayer()创建。所以NewMonster()和NewPlayer()我们也需要传给wire。

写完之后，调用wire命令，会生成wire_gen.go文件
```go
// Code generated by Wire. DO NOT EDIT.

//go:generate wire
//+build !wireinject

package main

// Injectors from wire.go:

func InitMission(name string) Mission {
  player := NewPlayer(name)
  monster := NewMonster()
  mission := NewMission(player, monster)
  return mission
}
```

它会创建对象，将需要的参数传递给需要这些参数的函数
我们在main函数中调用
```go
func main() {
  mission := InitMission("dj")

  mission.Start()
}
```